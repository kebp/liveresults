CREATE TABLE `login` (
  `user` varchar(50) NOT NULL DEFAULT '',
  `pass` varchar(50) DEFAULT NULL,
  `tavid` int(11) NOT NULL,
  `compName` varchar(50) DEFAULT NULL,
  `compDate` datetime DEFAULT NULL,
  `public` tinyint(1) DEFAULT NULL,
  `organizer` varchar(50) DEFAULT NULL,
  `timediff` int(11) NOT NULL DEFAULT 0,
  `tenths` tinyint(1) NOT NULL DEFAULT 0,
  `multidaystage` int(11) DEFAULT NULL,
  `multidayparent` int(11) DEFAULT NULL,
  `timezone` varchar(10) DEFAULT NULL,
  `country` varchar(2) DEFAULT NULL,
  PRIMARY KEY (`tavid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `results` (
  `tavid` int(11) NOT NULL DEFAULT 0,
  `dbid` int(11) NOT NULL DEFAULT 0,
  `control` int(11) NOT NULL DEFAULT 0,
  `time` int(11) NOT NULL DEFAULT 0,
  `finalPosition` int(11) NOT NULL DEFAULT 0,
  `status` int(11) DEFAULT 0,
  `changed` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`tavid`,`dbid`,`control`),
  KEY `Results_Indexd` (`tavid`,`status`,`time`),
  KEY `resIndex2` (`tavid`,`dbid`,`control`,`status`,`time`),
  KEY `dbid` (`dbid`,`tavid`),
  CONSTRAINT `results_ibfk_1` FOREIGN KEY (`dbid`, `tavid`) REFERENCES `runners` (`dbid`, `tavid`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `runners` (
  `tavid` int(11) NOT NULL DEFAULT 0,
  `name` varchar(50) NOT NULL DEFAULT '',
  `club` varchar(50) DEFAULT NULL,
  `class` varchar(50) DEFAULT NULL,
  `bib` varchar(50) DEFAULT NULL,
  `brick` int(11) DEFAULT NULL,
  `dbid` int(11) NOT NULL DEFAULT 0,
  PRIMARY KEY (`dbid`,`tavid`),
  KEY `runners_class` (`class`),
  KEY `idx_runner_club` (`tavid`,`club`),
  KEY `idx_runner_class` (`tavid`,`class`),
  CONSTRAINT `runners_ibfk_1` FOREIGN KEY (`tavid`) REFERENCES `login` (`tavid`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `splitcontrols` (
  `tavid` int(11) NOT NULL DEFAULT 0,
  `classname` varchar(50) NOT NULL DEFAULT '',
  `corder` int(11) NOT NULL DEFAULT 0,
  `code` int(11) NOT NULL DEFAULT 0,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`tavid`,`classname`,`corder`,`code`),
  CONSTRAINT `splitcontrols_ibfk_1` FOREIGN KEY (`tavid`) REFERENCES `login` (`tavid`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `runneraliases` (
  `compid` int(11) NOT NULL,
  `sourceid` varchar(50) NOT NULL,
  `id` int(11) NOT NULL,
  PRIMARY KEY (`compid`,`sourceid`),
  CONSTRAINT `runneraliases_ibfk_1` FOREIGN KEY (`compid`) REFERENCES `runners` (`tavid`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
